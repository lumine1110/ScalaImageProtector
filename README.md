# ScalaImageProtector

画像内の**数字のみ**を自動的に検出し、ぼかし処理（マスキング）を行ってプライバシーを保護するScalaアプリケーションです。

## 特徴

*   **数字特化の検出**: Tesseract OCRを使用し、画像内のテキストから数字のみをピンポイントで特定します。英字（例: "Test"）は無視されます。
*   **高精度な認識**:
    *   **大津の二値化**: 画像の明るさに応じて最適な閾値を自動設定し、文字を鮮明に切り出します。
    *   **文字単位の解析**: 輪郭検出ではなく、OCRエンジンによる文字位置特定を行うことで、隣接する文字や複雑なレイアウトにも対応します。
*   **プライバシー保護**: 検出された数字領域に対して、強力なガウシアンブラー（ぼかし）を適用し、視認不可能にします。
*   **自動テスト生成**: 実行時にテスト用の画像を自動生成し、即座に動作確認が可能です。
*   **自己検証機能**: 処理後の画像を再度OCRにかけ、数字が残っていないかを自動的にチェックします。

## 必要要件

*   Scala 3.3.1
*   sbt
*   Java Development Kit (JDK) 11以上
*   インターネット接続（初回実行時にTesseractの学習データをダウンロードするため）

## 使用ライブラリ

*   **JavaCV (OpenCV)**: 画像処理（読み込み、保存、前処理、ぼかし）
*   **Tesseract (JavaCPP Presets)**: 光学文字認識（OCR）

## セットアップと実行

1.  プロジェクトのルートディレクトリで以下のコマンドを実行します。

    ```bash
    sbt run
    ```

2.  初回実行時:
    *   `input` ディレクトリにテスト画像（`test_1.jpg` 〜 `test_3.jpg`）が自動生成されます。
    *   `tessdata` ディレクトリにOCR学習データ（`eng.traineddata`）がダウンロードされます。

3.  処理完了後:
    *   `output` ディレクトリに、数字部分がぼかされた画像（`masked_test_*.jpg`）が保存されます。
    *   コンソールに処理結果と検証結果（`[OK]` または `[警告]`）が表示されます。

## プロジェクト構成

*   `src/main/scala/`
    *   `Main.scala`: アプリケーションのエントリーポイント。全体のフロー制御と検証処理。
    *   `OcrService.scala`: Tesseract OCRの初期化、学習データ管理、文字認識ロジック。
    *   `ImageProcessor.scala`: OpenCVを使用した画像読み書き、二値化、ぼかし処理。
    *   `FileUtil.scala`: ファイル操作とテスト画像生成ユーティリティ。

## カスタマイズ

*   **ぼかしの強さ**: `ImageProcessor.scala` の `maskRegion` メソッド内の `GaussianBlur` のパラメータ（カーネルサイズやSigma）を変更することで調整可能です。
*   **認識対象**: `OcrService.scala` の `getDigitRegions` メソッド内の正規表現（現在は `\\d`）を変更することで、数字以外（例: アルファベット）を対象にすることも可能です。

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。